plugins {
    id 'java-library'
    id 'jacoco'
}
group 'com.cslgduke.dmeo'
version '1.0-SNAPSHOT'

subprojects{
    apply plugin: 'java-library'
    apply plugin: 'jacoco'

    jacocoTestReport {
        reports {
            xml.enabled true
        }
        afterEvaluate {
            classDirectories.setFrom(files(classDirectories.files.collect {
                fileTree(dir: it,
                        exclude: [
                                '**/ActivityExecutionListener.java',
                                '**/SurveyExecutionListener.java',
                                '**/SurveyExecutionConsumService.java',
                                '**/ActivityExecutionConsumService.java',
                                '**/AnalyticsDataModelService.java',
                                '**/KpiQueryDataService.java',
                                '**/KpiApplicationService.java',
                                '**/AnalyticsUtils.java',
                                '**/ValidationAspect.java',
                                '**/ResourcesReader.java',
                                '**/nextBestAction/**'
                        ]
                )
            }))
        }
    }
    test.finalizedBy jacocoTestReport
    repositories {
        mavenLocal()
        mavenCentral()
    }
    dependencies {
        implementation 'cn.hutool:hutool-all:5.3.6'
        testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.1'
        testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.1'

        compileOnly  'org.projectlombok:lombok:1.18.22'
        annotationProcessor 'org.projectlombok:lombok:1.18.22'
        testCompileOnly 'org.projectlombok:lombok:1.18.22'
        testAnnotationProcessor 'org.projectlombok:lombok:1.18.22'

        testImplementation 'org.mockito:mockito-core:4.4.0'
        testImplementation 'org.mockito:mockito-junit-jupiter:4.4.0'
        testImplementation 'org.mockito:mockito-inline:4.4.0'

        implementation 'com.alibaba:fastjson:1.2.68'
    }
    test {
        useJUnitPlatform()
    }

    jacocoTestCoverageVerification {
        violationRules {
            rule {
                limit {
                    minimum = 0.01
                }
            }
        }
    }
}


